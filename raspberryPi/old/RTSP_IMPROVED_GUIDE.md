# 改良版 RTSP ストリーミングテストサーバー ガイド

## 概要

`rtsp_continuous_improved.py`は、元の`rtsp_continuous_test.py`を改良したバージョンです。ユーザーの要求に基づいて以下の機能を実装しています。

## 主な改良点

### 1. 自動実行機能

- スクリプト実行時に VLC RTSP サーバーが即座に開始されます
- 選択画面で Enter キーを押すだけで自動実行
- 手動でコマンドを入力する必要がありません

### 2. 詳細な日時表示

- "RTSP TEST"の下に現在の日時を表示
- 表示形式：
  - 日付：2025 年 05 月 29 日
  - 時刻：09 時 40 分 30 秒
  - ISO 形式：2025-05-29 09:40:30

### 3. 5 秒間隔での画像更新

- 画像は 5 秒ごとに自動更新されます
- 更新のたびにログが出力されます
- 時刻が秒単位で変化することを確認できます

## 使用方法

### 基本的な使用方法

```bash
cd raspberryPi
python3 rtsp_continuous_improved.py
```

### 実行例

```
🎬 改良版RTSPストリーミングテストサーバー
============================================================
📝 自動機能:
   • VLC RTSPサーバーを即座に開始
   • 画像を5秒間隔で自動更新
   • 日時を秒単位まで表示
============================================================
1. VLC RTSPサーバー（推奨・自動実行）
2. FFmpeg UDPサーバー（代替オプション）
============================================================
サーバーを選択してください (1-2, Enterで1):
```

### 推奨操作

1. **Enter キーを押す**（または「1」を入力）
2. VLC RTSP サーバーが自動的に開始されます
3. 表示された RTSP URL を VLC で開きます

## 画像の内容

生成される画像には以下の情報が含まれます：

```
        RTSP TEST

      2025年05月29日

      09時40分30秒

    2025-05-29 09:40:30

    画像更新間隔: 5秒
```

## ログ出力例

```
2025-05-29 09:40:30,123 - INFO - 🚀 VLC RTSPサーバーを自動開始します...
2025-05-29 09:40:30,456 - INFO - 📸 画像を更新しました: 09:40:30
2025-05-29 09:40:30,789 - INFO - 📺 VLC RTSPサーバーを自動開始しています...
2025-05-29 09:40:35,123 - INFO - ✅ VLC RTSPサーバーが開始されました
2025-05-29 09:40:35,456 - INFO - 📺 RTSP URL: rtsp://192.168.1.100:8554/test
2025-05-29 09:40:35,789 - INFO - 📸 画像を更新しました: 09:40:35
2025-05-29 09:40:40,123 - INFO - 📸 画像を更新しました: 09:40:40
```

## VLC での視聴方法

1. VLC を起動
2. **メディア** → **ネットワークストリームを開く** (Ctrl+N)
3. 表示された RTSP URL を入力：
   ```
   rtsp://192.168.1.100:8554/test
   ```
4. **再生**をクリック

## 代替オプション

VLC RTSP サーバーが動作しない場合は、オプション 2 の FFmpeg UDP サーバーを選択できます：

- UDP URL: `udp://192.168.1.100:8554`
- VLC で上記 URL を開いて視聴

## トラブルシューティング

### VLC が見つからない場合

```bash
# VLCをインストール
sudo apt update
sudo apt install vlc
```

### ポートが使用中の場合

```bash
# ポート8554を使用しているプロセスを確認
sudo netstat -tulpn | grep 8554

# プロセスを終了
sudo kill -9 <プロセスID>
```

### 画像が更新されない場合

- `/tmp/rtsp_test.jpg`ファイルの権限を確認
- ディスク容量を確認
- ログでエラーメッセージを確認

## 元のスクリプトとの違い

| 項目         | 元のスクリプト | 改良版         |
| ------------ | -------------- | -------------- |
| 実行方法     | 手動選択       | 自動実行       |
| 画像更新間隔 | 1 秒           | 5 秒           |
| 日時表示     | 簡易           | 詳細（秒まで） |
| 操作性       | 選択が必要     | Enter で即実行 |

## 注意事項

- Raspberry Pi 4B での使用を想定しています
- 長時間実行時はシステム温度に注意してください
- ネットワーク帯域幅を考慮してください
