# SEC-3000H Elevator Auto Pilot - USB Direct Connection

PC ã¨ Raspberry Pi 4 ã‚’ USB ã‚±ãƒ¼ãƒ–ãƒ«ã§ç›´æ¥æ¥ç¶šã—ã¦ã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼è‡ªå‹•æ“ç¸¦ã‚’è¡Œã†ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚

## æ¦‚è¦

- **ç›®çš„**: PC ã¨ Raspberry Pi 4 ã® USB ç›´æ¥é€šä¿¡ã«ã‚ˆã‚‹ã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼åˆ¶å¾¡
- **é€šä¿¡**: JSON å½¢å¼ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã‚ˆã‚‹é«˜é€Ÿ USB é€šä¿¡ï¼ˆ115200bpsï¼‰
- **è¡¨ç¤º**: Raspberry Pi 4 ã§ RTSP ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°æ˜ åƒç”Ÿæˆ
- **å¯¾è±¡**: ã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼å†…ãƒ¢ãƒ‹ã‚¿ãƒ¼è¡¨ç¤º

## ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    USB Cable    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    RTSP    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Windows PC    â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚ Raspberry Pi 4  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚   ãƒ¢ãƒ‹ã‚¿ãƒ¼   â”‚
â”‚  backend-cli    â”‚   JSONé€šä¿¡      â”‚   æ¡ˆå†…ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ â”‚  æ˜ åƒé…ä¿¡   â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   115200bps     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ©Ÿèƒ½

### backend-cli (Windows PC)

- USB è‡ªå‹•æ¤œå‡ºã«ã‚ˆã‚‹ Raspberry Pi 4 ç™ºè¦‹
- JSON å½¢å¼ã®ã‚³ãƒãƒ³ãƒ‰é€ä¿¡ï¼ˆéšæ•°è¨­å®šãƒ»æ‰‰åˆ¶å¾¡ï¼‰
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ çŠ¶æ…‹å—ä¿¡
- B1F â†’ 1F â†’ 2F â†’ 3F â†’ 4F â†’ 5F ã®å¾ªç’°é‹è»¢

### Raspberry Pi 4

- USB ç›´æ¥é€šä¿¡å—ä¿¡ãƒ»JSON è§£æ
- ã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼çŠ¶æ…‹ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
- RTSP ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°æ˜ åƒç”Ÿæˆ
- æ¡ˆå†…ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤è¡¨ç¤ºåˆ¶å¾¡

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

### backend-cli (Windows PC)

```bash
cd backend-cli
pip install pyserial
```

### Raspberry Pi 4

```bash
sudo apt update
sudo apt install python3-pip python3-gi python3-gi-cairo gir1.2-gtk-3.0
sudo apt install gstreamer1.0-tools gstreamer1.0-plugins-base gstreamer1.0-plugins-good
sudo apt install gstreamer1.0-plugins-bad gstreamer1.0-plugins-ugly gstreamer1.0-libav
sudo apt install python3-pil

pip3 install pyserial
```

## ä½¿ç”¨æ–¹æ³•

### 1. Raspberry Pi 4 èµ·å‹•

```bash
cd raspberryPi
python3 usb_elevator_display.py
```

#### ã‚ªãƒ—ã‚·ãƒ§ãƒ³

```bash
# RTSPã‚µãƒ¼ãƒãƒ¼ãªã—ã§èµ·å‹•
python3 usb_elevator_display.py --no-rtsp

# USBãƒ‡ãƒã‚¤ã‚¹ãƒ‘ã‚¹æŒ‡å®š
python3 usb_elevator_display.py --usb-device /dev/ttyACM1
```

### 2. backend-cli èµ·å‹• (Windows PC)

```bash
cd backend-cli
python elevator_usb_pilot.py
```

#### ã‚ªãƒ—ã‚·ãƒ§ãƒ³

```bash
# æ‰‹å‹•ãƒ¢ãƒ¼ãƒ‰ï¼ˆè‡ªå‹•é‹è»¢ã—ãªã„ï¼‰
python elevator_usb_pilot.py --manual
```

### 3. ãƒ¢ãƒ‹ã‚¿ãƒ¼è¡¨ç¤º

RTSP ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’ãƒ¢ãƒ‹ã‚¿ãƒ¼ã§è¡¨ç¤ºï¼š

```
rtsp://[Raspberry_Pi_IP]:8554/elevator
```

## é€šä¿¡ãƒ—ãƒ­ãƒˆã‚³ãƒ«

### JSON ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å½¢å¼

#### PC â†’ Raspberry Pi 4

**è­˜åˆ¥è¦æ±‚**

```json
{
  "type": "identify",
  "timestamp": "2025-05-29T15:30:45.123456"
}
```

**éšæ•°è¨­å®š**

```json
{
  "type": "set_floor",
  "floor": "3F",
  "timestamp": "2025-05-29T15:30:45.123456"
}
```

**æ‰‰åˆ¶å¾¡**

```json
{
  "type": "door_control",
  "action": "open",
  "timestamp": "2025-05-29T15:30:45.123456"
}
```

#### Raspberry Pi 4 â†’ PC

**è­˜åˆ¥å¿œç­”**

```json
{
  "type": "identify_response",
  "device": "raspberry_pi_elevator",
  "version": "2.0",
  "capabilities": ["rtsp_streaming", "elevator_display"],
  "timestamp": "2025-05-29T15:30:45.123456"
}
```

**ACK å¿œç­”**

```json
{
  "type": "ack",
  "command": "set_floor",
  "floor": "3F",
  "timestamp": "2025-05-29T15:30:45.123456"
}
```

**çŠ¶æ…‹æ›´æ–°**

```json
{
  "type": "status_update",
  "current_floor": "3F",
  "target_floor": null,
  "is_moving": false,
  "door_status": "opening",
  "load_weight": 0,
  "timestamp": "2025-05-29T15:30:45.123456"
}
```

## è¡¨ç¤ºå†…å®¹

### åœæ­¢æ™‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ USBæ¥ç¶š         â”‚
â”‚     ç¾åœ¨éš      â”‚
â”‚                 â”‚
â”‚       3F        â”‚
â”‚                 â”‚
â”‚ 2025å¹´5æœˆ29æ—¥   â”‚
â”‚   15:30:45     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç§»å‹•ä¸­

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ USBæ¥ç¶š         â”‚
â”‚     ç§»å‹•ä¸­      â”‚
â”‚                 â”‚
â”‚   3F â†’ 5F      â”‚
â”‚       â–¶        â”‚
â”‚                 â”‚
â”‚ 2025å¹´5æœˆ29æ—¥   â”‚
â”‚   15:30:45     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ãƒ­ã‚°å‡ºåŠ›ä¾‹

### backend-cli (Windows PC)

```
ğŸš€ SEC-3000H Elevator Auto Pilot - USB Direct Connection
ğŸ“± PCã¨Raspberry Pi 4ã®USBç›´æ¥é€šä¿¡ç‰ˆ
============================================================
ğŸ” Raspberry Pi 4ã‚’æ¤œç´¢ä¸­...
âœ… Raspberry Pi 4ã‚’ç™ºè¦‹: COM5
âœ… USBæ¥ç¶šæˆåŠŸ: COM5
ğŸ“¡ é€šä¿¡è¨­å®š: 115200bps, USBç›´æ¥é€šä¿¡

ğŸš€ USBç›´æ¥é€šä¿¡è‡ªå‹•é‹è»¢é–‹å§‹
ğŸ¢ é‹è»¢ã‚·ãƒ¼ã‚±ãƒ³ã‚¹: B1F â†’ 1F â†’ 2F â†’ 3F â†’ 4F â†’ 5F

ğŸ¯ æ¬¡ã®ç›®æ¨™éš: 2F (ç¾åœ¨: 1F)
ğŸ“¤ USBé€ä¿¡: door_control - {'action': 'close'}
âœ… ACKå—ä¿¡: door_control
ğŸ“¤ USBé€ä¿¡: set_floor - {'floor': '2F'}
âœ… ACKå—ä¿¡: set_floor
ğŸ“Š çŠ¶æ…‹æ›´æ–°: ç¾åœ¨éš=2F, è¡Œå…ˆéš=None
```

### Raspberry Pi 4

```
ğŸ¢ SEC-3000H ã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼æ¡ˆå†…ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤èµ·å‹•ä¸­...
ğŸ“± USBç›´æ¥é€šä¿¡ç‰ˆ
ğŸ”Œ USBãƒ‡ãƒã‚¤ã‚¹: /dev/ttyACM0
âœ… USBæ¥ç¶šæˆåŠŸ: /dev/ttyACM0
ğŸ“¡ é€šä¿¡è¨­å®š: 115200bps, USBç›´æ¥é€šä¿¡
ğŸ§ USBå—ä¿¡é–‹å§‹...
âœ… RTSPã‚µãƒ¼ãƒãƒ¼èµ·å‹•: rtsp://192.168.40.239:8554/elevator

ğŸ“¨ USBå—ä¿¡: identify
ğŸ” è­˜åˆ¥è¦æ±‚ã«å¿œç­”ã—ã¾ã—ãŸ
ğŸ“¨ USBå—ä¿¡: door_control
ğŸšª æ‰‰åˆ¶å¾¡: close
ğŸ“¨ USBå—ä¿¡: set_floor
ğŸ¯ ç§»å‹•æŒ‡ç¤º: 1F â†’ 2F
âœ… ç§»å‹•å®Œäº†: 2F
```

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### USB æ¥ç¶šã‚¨ãƒ©ãƒ¼

- USB ã‚±ãƒ¼ãƒ–ãƒ«ã®æ¥ç¶šç¢ºèª
- Raspberry Pi 4 ã®é›»æºç¢ºèª
- ãƒ‡ãƒã‚¤ã‚¹ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã®ç¢ºèªï¼ˆWindowsï¼‰
- `/dev/ttyACM0`ã®æ¨©é™ç¢ºèªï¼ˆLinuxï¼‰

### è‡ªå‹•æ¤œå‡ºå¤±æ•—

- è¤‡æ•°ã® USB ãƒãƒ¼ãƒˆã‚’è©¦è¡Œ
- Raspberry Pi 4 ã®å†èµ·å‹•
- USB ã‚±ãƒ¼ãƒ–ãƒ«ã®äº¤æ›

### RTSP æ˜ åƒãŒè¡¨ç¤ºã•ã‚Œãªã„

- Raspberry Pi 4 ã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ç¢ºèª
- ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«è¨­å®šç¢ºèª
- GStreamer ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç¢ºèª

## é€šä¿¡è¨­å®š

### USB è¨­å®š

- **é€šä¿¡é€Ÿåº¦**: 115200bps
- **ãƒ‡ãƒ¼ã‚¿**: 8bit
- **ãƒ‘ãƒªãƒ†ã‚£**: ãªã—
- **ã‚¹ãƒˆãƒƒãƒ—**: 1bit
- **ãƒ•ãƒ­ãƒ¼åˆ¶å¾¡**: ãªã—

### è‡ªå‹•æ¤œå‡ºãƒãƒ¼ãƒˆ

**Windows**

- COM3, COM4, COM5, COM6, COM7, COM8, COM9, COM10

**Linux**

- /dev/ttyACM0, /dev/ttyACM1, /dev/ttyUSB0, /dev/ttyUSB1

## åˆ©ç‚¹

1. **é«˜é€Ÿé€šä¿¡**: 115200bps ã®é«˜é€Ÿ USB é€šä¿¡
2. **ç°¡å˜æ¥ç¶š**: USB ã‚±ãƒ¼ãƒ–ãƒ« 1 æœ¬ã§æ¥ç¶š
3. **è‡ªå‹•æ¤œå‡º**: Raspberry Pi 4 ã®è‡ªå‹•ç™ºè¦‹
4. **JSON é€šä¿¡**: äººé–“ãŒèª­ã¿ã‚„ã™ã„é€šä¿¡ãƒ—ãƒ­ãƒˆã‚³ãƒ«
5. **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ **: å³åº§ã®çŠ¶æ…‹åŒæœŸ

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT License
